<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATTIVO</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --lime:       #c8f135;
  --lime-dim:   #9dbf1e;
  --lime-glow:  rgba(200,241,53,0.18);
  --lime-faint: rgba(200,241,53,0.07);
  --black:      #070906;
  --dark:       #0d1009;
  --panel:      #111509;
  --card:       #161b0e;
  --border:     #1f2614;
  --border-hi:  #2d3a18;
  --muted:      #485535;
  --text:       #c8d9b4;
  --white:      #eaf4d8;
  --gold:       #f5c842;
  --gold-faint: rgba(245,200,66,0.12);
  --silver:     #b0bec5;
  --og:       #2775ca;
  --og-faint: rgba(39,117,202,0.15);
}

html, body { height: 100%; background: var(--black); color: var(--white); font-family: 'DM Sans', sans-serif; overflow-x: hidden; }

/* ─────────────────────────────────
   SIGNIN SCREEN
───────────────────────────────── */
#signinScreen {
  position: fixed; inset: 0; z-index: 200;
  background: var(--black);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
}
.signin-bg-grid {
  position: absolute; inset: -10%;
  background-image:
    linear-gradient(rgba(200,241,53,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(200,241,53,0.04) 1px, transparent 1px);
  background-size: 60px 60px;
  animation: gridDrift 20s linear infinite;
  pointer-events: none;
}
.signin-glow {
  position: absolute; width: 600px; height: 600px;
  border-radius: 50%; filter: blur(120px); opacity: 0.1;
  background: var(--lime); top: -200px; right: -100px; pointer-events: none;
}
@keyframes gridDrift { from{transform:translateY(0)} to{transform:translateY(60px)} }

.signin-content {
  position: relative; z-index: 1;
  display: flex; flex-direction: column; align-items: center; gap: 8px;
  margin-bottom: 48px;
}
.signin-logo-mark {
  width: 56px; height: 56px; background: var(--lime); border-radius: 14px;
  display: flex; align-items: center; justify-content: center; margin-bottom: 8px;
  box-shadow: 0 0 40px rgba(200,241,53,0.3);
  animation: logoPop 0.5s cubic-bezier(0.34,1.56,0.64,1) both;
}
.signin-logo-mark svg { display:block; }
@keyframes logoPop { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }
.signin-logo-name { font-family: 'Bebas Neue', sans-serif; font-size: 42px; letter-spacing: 5px; animation: fadeUp 0.5s 0.15s ease both; }
.signin-tagline { font-size: 13px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; animation: fadeUp 0.5s 0.25s ease both; }

.signin-panel {
  position: relative; z-index: 1;
  background: var(--panel); border: 1px solid var(--border-hi);
  border-radius: 20px; padding: 32px 28px; width: min(340px, 92vw);
  animation: fadeUp 0.5s 0.35s ease both;
}
.signin-panel h3 { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: 2px; margin-bottom: 4px; }
.signin-panel p { font-size: 13px; color: var(--muted); margin-bottom: 24px; }

.wallet-opt {
  width: 100%; display: flex; align-items: center; gap: 12px;
  padding: 14px 16px; border-radius: 12px;
  border: 1px solid var(--border-hi); background: var(--dark);
  color: var(--text); font-family: 'DM Sans', sans-serif;
  font-size: 14px; font-weight: 500; cursor: pointer;
  transition: all 0.2s; margin-bottom: 10px; text-align: left;
}
.wallet-opt:hover { border-color: var(--lime); color: var(--white); background: var(--lime-faint); transform: translateY(-1px); box-shadow: 0 4px 20px var(--lime-glow); }
.wico { width: 34px; height: 34px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.wsub { font-size: 11px; color: var(--muted); font-weight: 300; display: block; margin-top: 1px; }
.warr { margin-left: auto; color: var(--muted); transition: all 0.2s; font-size: 18px; }
.wallet-opt:hover .warr { color: var(--lime); transform: translateX(3px); }

.connect-spinner-wrap { display: none; flex-direction: column; align-items: center; gap: 14px; padding: 24px 0; }
.connect-spinner-wrap.show { display: flex; }
.connect-spinner { width: 44px; height: 44px; border: 3px solid var(--border); border-top-color: var(--lime); border-radius: 50%; animation: spin 0.7s linear infinite; }
@keyframes spin { to{ transform: rotate(360deg); } }
.connect-label { font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px; color: var(--lime); }
.connect-sub { font-size: 12px; color: var(--muted); }

@keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

#signinScreen.slide-out { animation: slideOut 0.6s cubic-bezier(0.4,0,0.2,1) forwards; }
@keyframes slideOut { from{transform:translateY(0);opacity:1} to{transform:translateY(-100%);opacity:0} }

/* ─────────────────────────────────
   APP SHELL
───────────────────────────────── */
#appShell { display: none; min-height: 100vh; flex-direction: column; }
#appShell.show { display: flex; animation: appReveal 0.5s 0.3s ease both; }
@keyframes appReveal { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

.app-bg { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }
.app-bg-grid {
  position: absolute; inset: -5%;
  background-image:
    linear-gradient(rgba(200,241,53,0.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(200,241,53,0.025) 1px, transparent 1px);
  background-size: 80px 80px;
}
.app-bg-glow1 { position: absolute; width: 500px; height: 500px; border-radius: 50%; filter: blur(100px); opacity: 0.08; background: var(--lime); top: -150px; right: -100px; animation: bgPulse 8s ease-in-out infinite alternate; }
.app-bg-glow2 { position: absolute; width: 300px; height: 300px; border-radius: 50%; filter: blur(80px); opacity: 0.05; background: #3be0a0; bottom: 100px; left: -80px; animation: bgPulse 10s ease-in-out infinite alternate-reverse; }
@keyframes bgPulse { from{opacity:0.05} to{opacity:0.12} }

/* ─────────────────────────────────
   TOP NAV
───────────────────────────────── */
.topnav {
  position: sticky; top: 0; z-index: 50;
  background: rgba(7,9,6,0.88); backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 20px; height: 60px; flex-shrink: 0;
}
.nav-logo { display: flex; align-items: center; gap: 10px; }
.nav-logo-mark { width: 32px; height: 32px; background: var(--lime); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
.nav-logo-name { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; }
.wallet-pill {
  display: flex; align-items: center; gap: 8px;
  background: var(--card); border: 1px solid var(--border-hi);
  border-radius: 100px; padding: 6px 12px 6px 8px;
  font-size: 12px; color: var(--text); cursor: pointer; transition: all 0.2s;
}
.wallet-pill:hover { border-color: var(--lime); color: var(--white); }
.wallet-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--lime); animation: blink 2s ease infinite; flex-shrink: 0; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* ─────────────────────────────────
   BOTTOM NAV
───────────────────────────────── */
.bottomnav {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 50;
  background: rgba(11,14,8,0.97); backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  display: flex; justify-content: space-around; align-items: center;
  padding: 8px 0 max(10px, env(safe-area-inset-bottom));
}
.bnav-item {
  display: flex; flex-direction: column; align-items: center; gap: 5px;
  padding: 6px 12px; border-radius: 10px; cursor: pointer;
  color: var(--muted); font-size: 10px; letter-spacing: 0.8px;
  text-transform: uppercase; transition: all 0.2s; border: none; background: none;
  font-family: 'DM Sans', sans-serif; font-weight: 400;
  -webkit-tap-highlight-color: transparent;
}
.bnav-item.active { color: var(--lime); }
.bnav-item.active .bnav-icon svg { stroke: var(--lime); }
.bnav-item:hover { color: var(--text); }
.bnav-item:hover .bnav-icon svg { stroke: var(--text); }
.bnav-icon { display: flex; align-items: center; justify-content: center; }
.bnav-icon svg { stroke: var(--muted); transition: stroke 0.2s; display: block; }

/* ─────────────────────────────────
   PAGE SYSTEM
───────────────────────────────── */
.main-scroll { flex: 1; overflow-y: auto; padding-bottom: 88px; position: relative; z-index: 1; }
.page { display: none; }
.page.active { display: block; animation: fadeUp 0.3s ease both; }

/* ─────────────────────────────────
   BALANCE HERO
───────────────────────────────── */
.balance-hero {
  background: linear-gradient(135deg, var(--card) 0%, #0e1a08 100%);
  border-bottom: 1px solid var(--border);
  padding: 20px 20px 22px; position: relative; overflow: hidden;
}
.balance-hero::before { content:''; position:absolute; inset:0; background: radial-gradient(ellipse at 80% 50%, rgba(200,241,53,0.06) 0%, transparent 60%); }
.balance-hero-inner { position: relative; z-index: 1; }
.balance-greeting { font-size: 11px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 2px; }
.balance-name { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: 2px; color: var(--white); margin-bottom: 18px; }
.balance-name span { color: var(--lime); }
.balance-cards { display: flex; gap: 12px; }
.bal-card {
  flex: 1; background: rgba(0,0,0,0.3); border: 1px solid var(--border-hi);
  border-radius: 14px; padding: 14px 16px; position: relative; overflow: hidden; transition: all 0.25s;
}
.bal-card:hover { border-color: var(--lime); transform: translateY(-2px); }
.bal-card-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 5px; }
.bal-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 1px; line-height: 1; }
.bal-card-sub { font-size: 11px; color: var(--muted); margin-top: 4px; }
.bal-card.points .bal-card-value { color: var(--lime); }
.bal-card.og .bal-card-value { color: #5b9bd5; }
.bal-card.og::before { content:''; position:absolute; inset:0; background: var(--og-faint); border-radius: inherit; }
.bal-card-icon { position:absolute; right:12px; top:12px; opacity:0.35; }

/* ─────────────────────────────────
   STREAK STRIP
───────────────────────────────── */
.streak-strip {
  margin: 16px 20px 0;
  background: var(--card); border: 1px solid var(--border-hi);
  border-radius: 14px; padding: 14px 18px;
  display: flex; align-items: center; gap: 14px;
}
.streak-flame { display: flex; align-items: center; }
.streak-text { flex: 1; }
.streak-num { font-family: 'Bebas Neue', sans-serif; font-size: 20px; color: var(--lime); }
.streak-label { font-size: 11px; color: var(--muted); margin-top: 1px; }
.streak-dots { display: flex; gap: 5px; }
.streak-dot { width: 9px; height: 9px; border-radius: 50%; background: var(--border); }
.streak-dot.done { background: var(--lime); box-shadow: 0 0 6px var(--lime-glow); }
.streak-dot.today { background: var(--gold); animation: blink 1.5s ease infinite; }

/* ─────────────────────────────────
   SECTION HEADERS
───────────────────────────────── */
.section-hdr {
  display: flex; align-items: center; justify-content: space-between;
  padding: 22px 20px 12px;
}
.section-label { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: var(--lime); font-weight: 500; margin-bottom: 2px; }
.section-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 1.5px; }

/* ─────────────────────────────────
   GLOBAL TIMER BAR
───────────────────────────────── */
.global-timer {
  margin: 0 20px 2px;
  display: flex; align-items: center; gap: 8px;
  background: rgba(200,241,53,0.05); border: 1px solid rgba(200,241,53,0.13);
  border-radius: 8px; padding: 8px 14px;
}
.global-timer-label { font-size: 11px; color: var(--muted); letter-spacing: 0.5px; }
.global-timer-val { font-family: 'Bebas Neue', sans-serif; font-size: 17px; letter-spacing: 2px; color: var(--lime); margin-left: auto; }

/* ─────────────────────────────────
   CHALLENGE CARDS
───────────────────────────────── */
.challenges-list { display: flex; flex-direction: column; gap: 14px; padding: 14px 20px 8px; }

.challenge-card {
  background: var(--card); border: 1px solid var(--border-hi);
  border-radius: 18px; overflow: hidden; position: relative;
  transition: all 0.25s; cursor: pointer;
  animation: fadeUp 0.4s ease both;
}
.challenge-card:nth-child(1) { animation-delay: 0.05s; }
.challenge-card:nth-child(2) { animation-delay: 0.12s; }
.challenge-card:nth-child(3) { animation-delay: 0.19s; }
.challenge-card:hover { transform: translateY(-3px); box-shadow: 0 12px 40px rgba(0,0,0,0.5); border-color: var(--lime); }

.challenge-card::before { content:''; position:absolute; left:0; top:0; bottom:0; width:4px; }
.challenge-card.tier-gold::before   { background: var(--gold); box-shadow: 0 0 12px var(--gold); }
.challenge-card.tier-silver::before { background: var(--silver); }
.challenge-card.tier-lime::before   { background: var(--lime); box-shadow: 0 0 10px var(--lime); }

.card-inner { padding: 18px 18px 18px 22px; position: relative; z-index: 1; }

.card-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }

.sport-tag {
  background: var(--dark); border: 1px solid var(--border-hi);
  border-radius: 100px; padding: 4px 12px;
  font-size: 11px; color: var(--text); letter-spacing: 0.8px; font-weight: 500; text-transform: uppercase;
}
.card-timer {
  display: flex; align-items: center; gap: 6px;
  background: rgba(200,241,53,0.07); border: 1px solid rgba(200,241,53,0.15);
  border-radius: 100px; padding: 4px 12px; font-size: 11px; color: var(--lime);
}
.card-timer-val { font-family: 'Bebas Neue', sans-serif; font-size: 14px; letter-spacing: 1.5px; }

.card-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; color: var(--white); margin-bottom: 4px; line-height: 1.1; }
.card-desc { font-size: 12px; color: var(--muted); font-weight: 300; line-height: 1.55; margin-bottom: 14px; }

.reward-tags { display: flex; gap: 7px; flex-wrap: wrap; margin-bottom: 14px; }
.reward-tag {
  display: flex; align-items: center; gap: 5px;
  border-radius: 6px; padding: 4px 10px;
  font-size: 11px; font-weight: 500; letter-spacing: 0.3px; border: 1px solid transparent;
}
.tag-badge  { background: var(--gold-faint); color: var(--gold); border-color: rgba(245,200,66,0.25); }
.tag-points { background: var(--lime-faint); color: var(--lime); border-color: rgba(200,241,53,0.25); }
.tag-usdc   { background: var(--og-faint); color: #5b9bd5; border-color: rgba(39,117,202,0.3); }
.tag-bonus  { background: rgba(168,130,255,0.1); color: #c4a5ff; border-color: rgba(168,130,255,0.25); }

.card-bottom { display: flex; align-items: center; gap: 12px; }
.card-progress-wrap { flex: 1; }
.card-progress-label { font-size: 11px; color: var(--muted); margin-bottom: 5px; display: flex; justify-content: space-between; }
.card-progress-bar { height: 5px; background: var(--dark); border-radius: 3px; overflow: hidden; }
.card-progress-fill { height: 100%; border-radius: 3px; transition: width 1.2s ease; }
.fill-gold   { background: linear-gradient(90deg, #c9a000, var(--gold)); }
.fill-silver { background: linear-gradient(90deg, #7a8b92, var(--silver)); }
.fill-lime   { background: linear-gradient(90deg, var(--lime-dim), var(--lime)); }

.card-cta {
  padding: 10px 18px; border-radius: 10px; border: none;
  font-family: 'Bebas Neue', sans-serif; font-size: 15px; letter-spacing: 1.5px;
  cursor: pointer; transition: all 0.2s; white-space: nowrap; flex-shrink: 0;
}
.cta-gold   { background: var(--gold); color: var(--black); }
.cta-silver { background: var(--silver); color: var(--black); }
.cta-lime   { background: var(--lime); color: var(--black); }
.card-cta:hover { transform: scale(1.04); box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
.card-cta:active { transform: scale(0.98); }

.challenge-card.completed { opacity: 0.62; }
.challenge-card.completed .card-cta { background: var(--muted); color: var(--dark); cursor: default; }
.challenge-card.completed .card-cta:hover { transform: none; box-shadow: none; }
.completed-badge {
  position: absolute; top: 14px; right: 14px; z-index: 2;
  background: var(--lime); color: var(--black);
  font-family: 'Bebas Neue', sans-serif; font-size: 11px; letter-spacing: 1px;
  padding: 3px 8px; border-radius: 100px;
}

/* ─────────────────────────────────
   CALENDAR PAGE
───────────────────────────────── */
.cal-tabs {
  display: flex; gap: 0;
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  background: transparent;
  position: sticky; top: 0; z-index: 10;
  background: rgba(7,9,6,0.9); backdrop-filter: blur(12px);
}
.cal-tab {
  padding: 14px 20px; font-size: 13px; font-weight: 500;
  color: var(--muted); cursor: pointer; border: none; background: none;
  font-family: 'DM Sans', sans-serif; letter-spacing: 0.3px;
  border-bottom: 2px solid transparent; transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
}
.cal-tab.active { color: var(--lime); border-bottom-color: var(--lime); }
.cal-tab:hover:not(.active) { color: var(--text); }

.cal-pane { display: none; }
.cal-pane.active { display: block; }

/* Calendar view */
.cal-month-hdr {
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 20px 10px;
}
.cal-month-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1.5px; }
.cal-nav-btn {
  width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border-hi);
  background: var(--card); color: var(--text); cursor: pointer; display: flex;
  align-items: center; justify-content: center; transition: all 0.2s;
}
.cal-nav-btn:hover { border-color: var(--lime); color: var(--lime); }

.cal-weekdays {
  display: grid; grid-template-columns: repeat(7, 1fr);
  padding: 0 20px; margin-bottom: 4px;
}
.cal-wd { text-align: center; font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); padding: 4px 0; }

.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); padding: 0 20px; gap: 3px; }
.cal-cell {
  aspect-ratio: 1; border-radius: 10px; display: flex; flex-direction: column;
  align-items: center; justify-content: center; cursor: pointer; position: relative;
  transition: all 0.15s; font-size: 13px; color: var(--text); gap: 3px;
}
.cal-cell:hover { background: var(--card); }
.cal-cell.today { background: var(--lime-faint); color: var(--lime); font-weight: 600; border: 1px solid rgba(200,241,53,0.25); }
.cal-cell.other-month { color: var(--muted); opacity: 0.4; }
.cal-cell.has-event::after {
  content: ''; width: 5px; height: 5px; border-radius: 50%; background: var(--lime);
}
.cal-cell.selected { background: var(--lime); color: var(--black); font-weight: 700; }
.cal-cell.selected::after { background: var(--black); }

/* Events list below calendar */
.events-section { padding: 16px 20px 0; }
.events-section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); margin-bottom: 12px; }
.event-item {
  background: var(--card); border: 1px solid var(--border-hi); border-radius: 14px;
  padding: 14px 16px; margin-bottom: 10px; display: flex; gap: 14px; align-items: flex-start;
  animation: fadeUp 0.3s ease both;
}
.event-item-dot {
  width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; margin-top: 4px;
}
.event-item-body { flex: 1; }
.event-item-name { font-size: 14px; font-weight: 500; color: var(--white); margin-bottom: 3px; }
.event-item-meta { font-size: 11px; color: var(--muted); display: flex; gap: 10px; flex-wrap: wrap; }
.event-item-cat {
  font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px;
  padding: 2px 8px; border-radius: 4px; border: 1px solid var(--border-hi);
  color: var(--text); background: var(--dark); margin-left: auto; flex-shrink: 0;
}

/* ─────────────────────────────────
   CREATE EVENT FORM
───────────────────────────────── */
.create-form { padding: 20px; display: flex; flex-direction: column; gap: 20px; }

.form-block {}
.form-label {
  display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 1.2px;
  color: var(--muted); margin-bottom: 8px; font-weight: 500;
}
.form-input, .form-textarea {
  width: 100%; padding: 13px 16px;
  background: var(--card); border: 1px solid var(--border-hi); border-radius: 12px;
  color: var(--white); font-family: 'DM Sans', sans-serif; font-size: 14px;
  outline: none; transition: all 0.2s; resize: none;
}
.form-input::placeholder, .form-textarea::placeholder { color: var(--muted); }
.form-input:focus, .form-textarea:focus { border-color: var(--lime); box-shadow: 0 0 0 3px rgba(200,241,53,0.08); }
.form-textarea { min-height: 88px; line-height: 1.6; }

/* Category scroll */
.cat-scroll {
  display: flex; gap: 10px; overflow-x: auto; padding-bottom: 4px;
  scrollbar-width: none;
}
.cat-scroll::-webkit-scrollbar { display: none; }
.cat-chip {
  flex-shrink: 0; padding: 10px 18px; border-radius: 100px;
  border: 1px solid var(--border-hi); background: var(--card);
  color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500;
  cursor: pointer; transition: all 0.2s; white-space: nowrap;
  -webkit-tap-highlight-color: transparent;
}
.cat-chip:hover { border-color: var(--lime); color: var(--white); }
.cat-chip.selected { background: var(--lime); color: var(--black); border-color: var(--lime); }
.cat-chip-inner { display: flex; align-items: center; gap: 8px; }
.cat-chip-icon { font-size: 16px; }

/* Date/time row */
.datetime-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* Participants */
.participants-row {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--card); border: 1px solid var(--border-hi); border-radius: 12px; padding: 12px 16px;
}
.participants-label { font-size: 14px; color: var(--text); }
.participants-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }
.participants-ctrl { display: flex; align-items: center; gap: 14px; }
.p-btn {
  width: 34px; height: 34px; border-radius: 50%; border: 1px solid var(--border-hi);
  background: var(--dark); color: var(--white); font-size: 18px; cursor: pointer;
  display: flex; align-items: center; justify-content: center; transition: all 0.2s;
  line-height: 1;
}
.p-btn:hover { border-color: var(--lime); color: var(--lime); }
.p-count { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--lime); min-width: 28px; text-align: center; }

/* Submit btn */
.submit-btn {
  width: 100%; padding: 16px; border-radius: 14px; border: none;
  background: var(--lime); color: var(--black);
  font-family: 'Bebas Neue', sans-serif; font-size: 19px; letter-spacing: 2px;
  cursor: pointer; transition: all 0.22s; position: relative; overflow: hidden;
}
.submit-btn::before { content:''; position:absolute; inset:0; background: linear-gradient(135deg,rgba(255,255,255,0.2) 0%,transparent 60%); }
.submit-btn:hover { background: #d4f545; transform: translateY(-2px); box-shadow: 0 8px 30px rgba(200,241,53,0.3); }
.submit-btn:active { transform: translateY(0); }
.submit-btn:disabled { background: var(--muted); color: var(--dark); transform: none; box-shadow: none; cursor: not-allowed; }

/* ─────────────────────────────────
   CONFIRMATION MODAL
───────────────────────────────── */
.modal-backdrop {
  position: fixed; inset: 0; z-index: 300;
  background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
  display: flex; align-items: flex-end; justify-content: center;
  padding: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.modal-backdrop.show { opacity: 1; pointer-events: all; }
.modal-sheet {
  background: var(--panel); border: 1px solid var(--border-hi);
  border-radius: 24px; padding: 32px 28px; width: min(420px, 100%);
  transform: translateY(40px); transition: transform 0.35s cubic-bezier(0.34,1.2,0.64,1);
  text-align: center;
}
.modal-backdrop.show .modal-sheet { transform: translateY(0); }

.modal-icon {
  width: 64px; height: 64px; border-radius: 50%; background: rgba(200,241,53,0.12);
  border: 2px solid rgba(200,241,53,0.3);
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 18px; animation: popIn 0.4s 0.1s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes popIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }
.modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 2px; color: var(--lime); margin-bottom: 6px; }
.modal-sub { font-size: 14px; color: var(--muted); font-weight: 300; line-height: 1.6; margin-bottom: 24px; }

.modal-event-card {
  background: var(--card); border: 1px solid var(--border-hi); border-radius: 14px;
  padding: 16px; margin-bottom: 24px; text-align: left;
}
.mec-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px; }
.mec-name { font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 1px; color: var(--white); }
.mec-cat { font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px; color: var(--lime); }
.mec-detail { font-size: 12px; color: var(--muted); margin-bottom: 3px; }

.modal-close-btn {
  width: 100%; padding: 14px; border-radius: 12px; border: none;
  background: var(--lime); color: var(--black);
  font-family: 'Bebas Neue', sans-serif; font-size: 17px; letter-spacing: 2px;
  cursor: pointer; transition: all 0.2s;
}
.modal-close-btn:hover { background: #d4f545; transform: translateY(-1px); }

/* ─────────────────────────────────
   POINTS TOAST
───────────────────────────────── */
.pts-toast {
  position: fixed; top: 70px; left: 50%; transform: translateX(-50%) translateY(-80px);
  background: var(--lime); color: var(--black);
  font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px;
  padding: 10px 22px; border-radius: 100px; z-index: 400;
  transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1); white-space: nowrap;
}
.pts-toast.show { transform: translateX(-50%) translateY(0); }

/* ─────────────────────────────────
   PLACEHOLDER PAGES (Store/Profile)
───────────────────────────────── */
/* ─────────────────────────────────
   SOCIAL FEED
───────────────────────────────── */
.social-hdr {
  padding: 22px 20px 6px;
  display: flex; align-items: flex-end; justify-content: space-between;
}
.social-hdr-label { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: var(--lime); margin-bottom: 2px; }
.social-hdr-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 1.5px; }
.social-count-pill {
  background: var(--lime-faint); border: 1px solid rgba(200,241,53,0.2);
  border-radius: 100px; padding: 4px 12px; font-size: 11px; color: var(--lime);
  font-weight: 500; letter-spacing: 0.5px;
}
.social-filter-row {
  display: flex; gap: 8px; padding: 10px 20px 14px;
  overflow-x: auto; scrollbar-width: none;
}
.social-filter-row::-webkit-scrollbar { display: none; }
.filter-chip {
  flex-shrink: 0; padding: 6px 14px; border-radius: 100px;
  border: 1px solid var(--border-hi); background: var(--card);
  color: var(--muted); font-size: 12px; font-weight: 500; cursor: pointer;
  transition: all 0.2s; white-space: nowrap; font-family: 'DM Sans', sans-serif;
  -webkit-tap-highlight-color: transparent;
}
.filter-chip:hover { border-color: var(--text); color: var(--text); }
.filter-chip.active { background: var(--lime); color: var(--black); border-color: var(--lime); }
.social-feed { display: flex; flex-direction: column; gap: 14px; padding: 0 20px; }
.social-card {
  background: var(--card); border: 1px solid var(--border-hi);
  border-radius: 18px; overflow: hidden; position: relative;
  transition: all 0.25s; animation: fadeUp 0.35s ease both;
}
.social-card:hover { border-color: rgba(200,241,53,0.3); box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
.social-card-accent { height: 3px; width: 100%; }
.social-card-body { padding: 16px 18px; }
.sc-top { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
.sc-avatar {
  width: 38px; height: 38px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Bebas Neue', sans-serif; font-size: 14px; letter-spacing: 1px;
  border: 2px solid rgba(255,255,255,0.1);
}
.sc-host-info { flex: 1; min-width: 0; }
.sc-host-name { font-size: 13px; font-weight: 500; color: var(--white); line-height: 1.2; }
.sc-host-sub  { font-size: 11px; color: var(--muted); }
.sc-cat-badge {
  padding: 4px 10px; border-radius: 6px; font-size: 10px;
  font-weight: 600; letter-spacing: 0.8px; text-transform: uppercase;
  border: 1px solid transparent; flex-shrink: 0;
}
.sc-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; color: var(--white); margin-bottom: 6px; line-height: 1.1; }
.sc-desc  { font-size: 13px; color: var(--muted); font-weight: 300; line-height: 1.6; margin-bottom: 14px; }
.sc-meta { display: flex; gap: 14px; flex-wrap: wrap; margin-bottom: 16px; }
.sc-meta-item { display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text); }
.sc-meta-item svg { flex-shrink: 0; opacity: 0.55; }
.sc-participants { margin-bottom: 16px; }
.sc-participants-label { display: flex; justify-content: space-between; align-items: baseline; font-size: 11px; margin-bottom: 7px; }
.sc-participants-text { color: var(--muted); letter-spacing: 0.3px; }
.sc-participants-count { font-family: 'Bebas Neue', sans-serif; font-size: 15px; letter-spacing: 0.5px; }
.sc-bar { height: 5px; background: var(--dark); border-radius: 3px; overflow: hidden; }
.sc-bar-fill { height: 100%; border-radius: 3px; transition: width 0.8s ease; }
.sc-bottom { display: flex; align-items: center; gap: 12px; }
.sc-spots-left { font-size: 12px; color: var(--muted); flex: 1; line-height: 1.5; }
.sc-spots-left strong { color: var(--lime); font-weight: 600; }
.sc-spots-left.full strong { color: #f87171; }
.join-btn {
  padding: 10px 22px; border-radius: 10px; border: none;
  font-family: 'Bebas Neue', sans-serif; font-size: 15px; letter-spacing: 1.5px;
  cursor: pointer; transition: all 0.22s; flex-shrink: 0;
}
.join-btn.join   { background: var(--lime); color: var(--black); }
.join-btn.join:hover { background: #d4f545; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(200,241,53,0.3); }
.join-btn.joined { background: transparent; color: var(--lime); border: 1px solid rgba(200,241,53,0.4); cursor: default; font-size: 13px; letter-spacing: 0.5px; }
.join-btn.joined:hover { transform: none; box-shadow: none; }
.join-btn.full   { background: var(--dark); color: var(--muted); border: 1px solid var(--border); cursor: not-allowed; font-size: 13px; }
.sc-owner-badge {
  display: inline-block; margin-bottom: 2px;
  background: rgba(200,241,53,0.1); border: 1px solid rgba(200,241,53,0.2);
  color: var(--lime); font-size: 10px; letter-spacing: 0.8px; text-transform: uppercase;
  padding: 2px 8px; border-radius: 100px; font-weight: 500;
}
.social-empty {
  text-align: center; padding: 60px 32px;
  display: flex; flex-direction: column; align-items: center; gap: 12px;
}
.social-empty svg { opacity: 0.12; margin-bottom: 4px; }
.social-empty h3 { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 2px; color: var(--muted); }
.social-empty p  { font-size: 13px; color: var(--muted); font-weight: 300; line-height: 1.6; }

.placeholder-page {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 80px 40px; text-align: center; gap: 12px;
}
.placeholder-page svg { opacity: 0.15; margin-bottom: 8px; }
.placeholder-page h2 { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: 2px; color: var(--muted); }
.placeholder-page p { font-size: 13px; color: var(--muted); font-weight: 300; }
</style>
</head>
<body>

<!-- ══════════════════════════════
     SIGN-IN SCREEN
══════════════════════════════ -->
<div id="signinScreen">
  <div class="signin-bg-grid"></div>
  <div class="signin-glow"></div>
  <div class="signin-content">
    <div class="signin-logo-mark">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#070906" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="5 3 19 12 5 21 5 3"/>
      </svg>
    </div>
    <div class="signin-logo-name">ATTIVO</div>
    <div class="signin-tagline">Move · Earn · Own</div>
  </div>

  <div class="signin-panel">
    <h3>Connect Wallet</h3>
    <p>Sign in to start earning rewards</p>

    <div id="fileProtocolNotice" style="display:none; background: rgba(248,113,113,0.12); border: 1px solid rgba(248,113,113,0.35); border-radius: 12px; padding: 12px 14px; margin-bottom: 20px; font-size: 12px; color: #fca5a5;">
      <strong>Wallet won’t connect from a file.</strong> Open this page from a local server instead. In terminal, run: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">npx serve .</code> then visit <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">http://localhost:3000</code>
    </div>

    <div id="walletOptions">
      <button class="wallet-opt" onclick="startConnect('MetaMask','Checking browser extension...')">
        <div class="wico" style="background:rgba(255,132,0,0.15)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#f5a623" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2L13 11M21 2h-6M21 2v6"/><path d="M3 22l8-9M3 22h6M3 22v-6"/><line x1="13" y1="11" x2="11" y2="13"/></svg>
        </div>
        <div>
          <div>MetaMask</div>
          <span class="wsub">Browser extension wallet</span>
        </div>
        <span class="warr">›</span>
      </button>
      <button class="wallet-opt" onclick="startConnect('Coinbase Wallet','Opening Coinbase Wallet...')">
        <div class="wico" style="background:rgba(0,82,255,0.12)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#4a7dff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        </div>
        <div>
          <div>Coinbase Wallet</div>
          <span class="wsub">Mobile or extension</span>
        </div>
        <span class="warr">›</span>
      </button>
      <button class="wallet-opt" onclick="startConnect('WalletConnect','Generating QR code...')">
        <div class="wico" style="background:rgba(59,153,252,0.12)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3b99fc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.5C8.5 9 15.5 9 19 12.5"/><path d="M8 15.5c2-2 6-2 8 0"/><circle cx="12" cy="18" r="1.2" fill="#3b99fc"/></svg>
        </div>
        <div>
          <div>WalletConnect</div>
          <span class="wsub">Any mobile wallet via QR</span>
        </div>
        <span class="warr">›</span>
      </button>
    </div>

    <div class="connect-spinner-wrap" id="connectSpinner">
      <div class="connect-spinner"></div>
      <div class="connect-label" id="spinnerLabel">Connecting</div>
      <div class="connect-sub" id="spinnerSub">Waiting for wallet...</div>
    </div>
  </div>
</div>

<!-- ══════════════════════════════
     MAIN APP
══════════════════════════════ -->
<div id="appShell">
  <div class="app-bg">
    <div class="app-bg-grid"></div>
    <div class="app-bg-glow1"></div>
    <div class="app-bg-glow2"></div>
  </div>

  <!-- Top Nav -->
  <nav class="topnav">
    <div class="nav-logo">
      <div class="nav-logo-mark">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#070906" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      </div>
      <span class="nav-logo-name">ATTIVO</span>
    </div>
    <div style="display:flex;align-items:center;gap:12px">
      <div class="wallet-pill">
        <div class="wallet-dot"></div>
        <span id="walletAddr">0x3f…a91c</span>
      </div>
      <div style="cursor:pointer;color:var(--muted);display:flex;align-items:center;transition:color 0.2s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/>
        </svg>
      </div>
    </div>
  </nav>

  <!-- Scroll Area -->
  <div class="main-scroll">

    <!-- ── PAGE: CHALLENGES (default home) ── -->
    <div class="page active" id="page-challenges">

      <div class="balance-hero">
        <div class="balance-hero-inner">
          <div class="balance-greeting">Good morning</div>
          <div class="balance-name">WELCOME BACK, <span id="userName">ALEX</span></div>
          <div class="balance-cards">
            <div class="bal-card points">
              <div class="bal-card-label">ATTIVO Points</div>
              <div class="bal-card-value" id="pointBalance">2,480</div>
              <div class="bal-card-sub">+150 today</div>
              <div class="bal-card-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
              </div>
            </div>
            <div class="bal-card og">
              <div class="bal-card-label">0G Balance</div>
              <div class="bal-card-value" id="ogBalance">12.40</div>
              <div class="bal-card-sub">On-chain balance</div>
              <div class="bal-card-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#5b9bd5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M12 6v12M9 9h4.5a2.5 2.5 0 010 5H9m0 0h4.5"/></svg>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="streak-strip">
        <div class="streak-flame">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2c0 0-1 3-1 6 0 2 1 3.5 1 3.5S10 10 10 7c-3 2-4 5-4 7a6 6 0 0012 0c0-4-3-8-6-12z"/>
          </svg>
        </div>
        <div class="streak-text">
          <div class="streak-num">5 DAY STREAK</div>
          <div class="streak-label">2 more days for bonus ×1.5</div>
        </div>
        <div class="streak-dots">
          <div class="streak-dot done"></div>
          <div class="streak-dot done"></div>
          <div class="streak-dot done"></div>
          <div class="streak-dot done"></div>
          <div class="streak-dot today"></div>
          <div class="streak-dot"></div>
          <div class="streak-dot"></div>
        </div>
      </div>

      <div class="section-hdr">
        <div>
          <div class="section-label">Today's Missions</div>
          <div class="section-title">Daily Challenges</div>
        </div>
        <div class="global-timer" style="margin:0;padding:6px 12px">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:5px"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
          <span class="global-timer-val" id="globalTimer">--:--:--</span>
        </div>
      </div>

      <div class="challenges-list">
        <!-- CHALLENGE 1 -->
        <div class="challenge-card tier-gold" id="card0">
          <div class="card-inner">
            <div class="card-top">
              <div class="sport-tag">Tennis</div>
              <div class="card-timer"><span class="card-timer-val" id="timer0">--:--:--</span></div>
            </div>
            <div class="card-title">Win a Ranked Match</div>
            <div class="card-desc">Complete and win a full ranked tennis match — singles or doubles. Verified by opponent check-in.</div>
            <div class="reward-tags">
              <div class="reward-tag tag-badge">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke:#f5c842;flex-shrink:0"><circle cx="12" cy="8" r="5"/><path d="M7 13l-3 8 8-3 8 3-3-8"/><circle cx="12" cy="8" r="2" fill="#f5c842" stroke="none"/></svg>
                Gold Match Badge
              </div>
              <div class="reward-tag tag-points">50 pts</div>
              <div class="reward-tag tag-usdc">0.50 0G</div>
              <div class="reward-tag tag-bonus">Streak ×1.5</div>
            </div>
            <div class="card-bottom">
              <div class="card-progress-wrap">
                <div class="card-progress-label"><span>Progress</span><span style="color:var(--gold)">0 / 1 match</span></div>
                <div class="card-progress-bar"><div class="card-progress-fill fill-gold" style="width:0%" id="prog0"></div></div>
              </div>
              <button class="card-cta cta-gold" onclick="startChallenge(0)">Start →</button>
            </div>
          </div>
        </div>

        <!-- CHALLENGE 2 -->
        <div class="challenge-card tier-silver" id="card1">
          <div class="card-inner">
            <div class="card-top">
              <div class="sport-tag">Cycling</div>
              <div class="card-timer"><span class="card-timer-val" id="timer1">--:--:--</span></div>
            </div>
            <div class="card-title">Ride 20km Today</div>
            <div class="card-desc">Log a cycling session of at least 20 km. Indoor or outdoor — tracked by GPS or wearable sync.</div>
            <div class="reward-tags">
              <div class="reward-tag tag-badge">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke:#b0bec5;flex-shrink:0"><circle cx="12" cy="8" r="5"/><path d="M7 13l-3 8 8-3 8 3-3-8"/><circle cx="12" cy="8" r="2" fill="#b0bec5" stroke="none"/></svg>
                Silver Endurance Badge
              </div>
              <div class="reward-tag tag-points">25 pts</div>
              <div class="reward-tag tag-usdc">0.25 0G</div>
            </div>
            <div class="card-bottom">
              <div class="card-progress-wrap">
                <div class="card-progress-label"><span>Progress</span><span style="color:var(--silver)">12.4 / 20 km</span></div>
                <div class="card-progress-bar"><div class="card-progress-fill fill-silver" style="width:62%" id="prog1"></div></div>
              </div>
              <button class="card-cta cta-silver" onclick="startChallenge(1)">Continue →</button>
            </div>
          </div>
        </div>

        <!-- CHALLENGE 3 -->
        <div class="challenge-card tier-lime" id="card2">
          <div class="card-inner">
            <div class="card-top">
              <div class="sport-tag">Workout</div>
              <div class="card-timer"><span class="card-timer-val" id="timer2">--:--:--</span></div>
            </div>
            <div class="card-title">30 Min Active Session</div>
            <div class="card-desc">Complete 30 minutes of moderate activity — gym, swim, yoga, or any tracked sport counts.</div>
            <div class="reward-tags">
              <div class="reward-tag tag-badge">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke:#c8f135;flex-shrink:0"><circle cx="12" cy="8" r="5"/><path d="M7 13l-3 8 8-3 8 3-3-8"/><circle cx="12" cy="8" r="2" fill="#c8f135" stroke="none"/></svg>
                Active Athlete Badge
              </div>
              <div class="reward-tag tag-points">10 pts</div>
              <div class="reward-tag tag-usdc">0.10 0G</div>
            </div>
            <div class="card-bottom">
              <div class="card-progress-wrap">
                <div class="card-progress-label"><span>Progress</span><span style="color:var(--lime)">0 / 30 min</span></div>
                <div class="card-progress-bar"><div class="card-progress-fill fill-lime" style="width:0%" id="prog2"></div></div>
              </div>
              <button class="card-cta cta-lime" onclick="startChallenge(2)">Start →</button>
            </div>
          </div>
        </div>
      </div>
      <div style="height:16px"></div>
    </div>

    <!-- ── PAGE: CALENDAR ── -->
    <div class="page" id="page-calendar">

      <!-- Sub-tabs: My Calendar / Create Event -->
      <div class="cal-tabs">
        <button class="cal-tab active" id="calTabView" onclick="switchCalTab('view')">My Calendar</button>
        <button class="cal-tab" id="calTabCreate" onclick="switchCalTab('create')">Create Event</button>
      </div>

      <!-- CALENDAR VIEW PANE -->
      <div class="cal-pane active" id="calPaneView">
        <div class="cal-month-hdr">
          <button class="cal-nav-btn" onclick="changeMonth(-1)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
          </button>
          <div class="cal-month-title" id="calMonthTitle">FEBRUARY 2026</div>
          <button class="cal-nav-btn" onclick="changeMonth(1)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
          </button>
        </div>

        <div class="cal-weekdays">
          <div class="cal-wd">Su</div><div class="cal-wd">Mo</div><div class="cal-wd">Tu</div>
          <div class="cal-wd">We</div><div class="cal-wd">Th</div><div class="cal-wd">Fr</div><div class="cal-wd">Sa</div>
        </div>

        <div class="cal-grid" id="calGrid"></div>

        <div class="events-section">
          <div class="events-section-title" id="eventsListTitle">Events this month</div>
          <div id="eventsList"></div>
        </div>
        <div style="height:16px"></div>
      </div>

      <!-- CREATE EVENT PANE -->
      <div class="cal-pane" id="calPaneCreate">
        <div class="create-form">

          <div class="form-block">
            <label class="form-label">Event Name</label>
            <input class="form-input" id="evtName" type="text" placeholder="e.g. Morning Tennis Session">
          </div>

          <div class="form-block">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="evtDesc" placeholder="What's happening? Any notes for participants…"></textarea>
          </div>

          <div class="form-block">
            <label class="form-label">Category</label>
            <div class="cat-scroll" id="catScroll">
              <button class="cat-chip" data-cat="Skiing" onclick="selectCat(this)">
                <div class="cat-chip-inner"><span class="cat-chip-icon">⛷</span> Ski / Snowboard</div>
              </button>
              <button class="cat-chip" data-cat="Workout" onclick="selectCat(this)">
                <div class="cat-chip-inner"><span class="cat-chip-icon">🏋</span> Workout</div>
              </button>
              <button class="cat-chip" data-cat="Tennis" onclick="selectCat(this)">
                <div class="cat-chip-inner"><span class="cat-chip-icon">🎾</span> Tennis</div>
              </button>
              <button class="cat-chip" data-cat="Cycling" onclick="selectCat(this)">
                <div class="cat-chip-inner"><span class="cat-chip-icon">🚴</span> Cycling</div>
              </button>
              <button class="cat-chip" data-cat="Running" onclick="selectCat(this)">
                <div class="cat-chip-inner"><span class="cat-chip-icon">🏃</span> Running</div>
              </button>
              <button class="cat-chip" data-cat="Surfing" onclick="selectCat(this)">
                <div class="cat-chip-inner"><span class="cat-chip-icon">🏄</span> Surfing</div>
              </button>
            </div>
          </div>

          <div class="form-block">
            <label class="form-label">Date & Time</label>
            <div class="datetime-row">
              <input class="form-input" id="evtDate" type="date">
              <input class="form-input" id="evtTime" type="time" value="08:00">
            </div>
          </div>

          <div class="form-block">
            <label class="form-label">Participants</label>
            <div class="participants-row">
              <div>
                <div class="participants-label">Max spots</div>
                <div class="participants-sub">Including yourself</div>
              </div>
              <div class="participants-ctrl">
                <button class="p-btn" onclick="adjustParticipants(-1)">−</button>
                <div class="p-count" id="pCount">4</div>
                <button class="p-btn" onclick="adjustParticipants(1)">+</button>
              </div>
            </div>
          </div>

          <button class="submit-btn" id="submitBtn" onclick="submitEvent()">Create Event →</button>
        </div>
        <div style="height:16px"></div>
      </div>
    </div>

    <!-- ── PAGE: SOCIAL ── -->
    <div class="page" id="page-social">
      <div class="social-hdr">
        <div>
          <div class="social-hdr-label">Community</div>
          <div class="social-hdr-title">Social Feed</div>
        </div>
        <div class="social-count-pill" id="socialCountPill">0 events</div>
      </div>

      <div class="social-filter-row">
        <button class="filter-chip active" data-filter="All" onclick="setFilter(this,'All')">All</button>
        <button class="filter-chip" data-filter="Tennis" onclick="setFilter(this,'Tennis')">Tennis</button>
        <button class="filter-chip" data-filter="Cycling" onclick="setFilter(this,'Cycling')">Cycling</button>
        <button class="filter-chip" data-filter="Skiing" onclick="setFilter(this,'Skiing')">Skiing</button>
        <button class="filter-chip" data-filter="Workout" onclick="setFilter(this,'Workout')">Workout</button>
        <button class="filter-chip" data-filter="Running" onclick="setFilter(this,'Running')">Running</button>
        <button class="filter-chip" data-filter="Surfing" onclick="setFilter(this,'Surfing')">Surfing</button>
      </div>

      <div class="social-feed" id="socialFeed"></div>
      <div style="height:20px"></div>
    </div>

    <!-- ── PAGE: STORE ── -->
    <div class="page" id="page-store">
      <div class="placeholder-page">
        <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
        <h2>Store</h2>
        <p>Redeem your points for gear,<br>experiences and exclusive drops.</p>
      </div>
    </div>

    <!-- ── PAGE: PROFILE ── -->
    <div class="page" id="page-profile">
      <div class="placeholder-page">
        <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
        <h2>Profile</h2>
        <p>Your sports passport, badges<br>and achievement history.</p>
      </div>
    </div>

  </div><!-- /main-scroll -->

  <!-- Bottom Nav — 4 tabs, no "Home" -->
  <nav class="bottomnav">
    <button class="bnav-item active" data-page="challenges">
      <span class="bnav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
      </span>
      Challenges
    </button>
    <button class="bnav-item" data-page="calendar">
      <span class="bnav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2"/>
          <path d="M16 2v4M8 2v4M3 10h18"/>
          <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01"/>
        </svg>
      </span>
      Calendar
    </button>
    <button class="bnav-item" data-page="social">
      <span class="bnav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 00-3-3.87"/>
          <path d="M16 3.13a4 4 0 010 7.75"/>
        </svg>
      </span>
      Social
    </button>
    <button class="bnav-item" data-page="store">
      <span class="bnav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <path d="M16 10a4 4 0 01-8 0"/>
        </svg>
      </span>
      Store
    </button>
    <button class="bnav-item" data-page="profile">
      <span class="bnav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/>
        </svg>
      </span>
      Profile
    </button>
  </nav>

</div><!-- /appShell -->

<!-- Confirmation Modal -->
<div class="modal-backdrop" id="confirmModal">
  <div class="modal-sheet">
    <div class="modal-icon">
      <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
    </div>
    <div class="modal-title">Event Created!</div>
    <div class="modal-sub">Your event has been added to your calendar and is open for participants to join.</div>
    <div class="modal-event-card" id="modalEventCard">
      <div class="mec-row">
        <div class="mec-name" id="mecName">—</div>
        <div class="mec-cat" id="mecCat">—</div>
      </div>
      <div class="mec-detail" id="mecDate">—</div>
      <div class="mec-detail" id="mecParticipants">—</div>
    </div>
    <button class="modal-close-btn" onclick="closeModal()">View in Calendar</button>
  </div>
</div>

<!-- Points Toast -->
<div class="pts-toast" id="ptsToast"><span id="ptsToastMsg">+50 PTS EARNED!</span></div>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
<script>
// ─────────────────────────────────
// 0G CHAIN CONFIG
// ─────────────────────────────────
const OG_NETWORK = {
  chainId: '0x40EA', // 16602
  chainName: '0G-Galileo-Testnet',
  nativeCurrency: { name: '0G', symbol: '0G', decimals: 18 },
  rpcUrls: ['https://evmrpc-testnet.0g.ai'],
  blockExplorerUrls: ['https://chainscan-galileo.0g.ai']
};
const OG_RPC = 'https://evmrpc-testnet.0g.ai';
let appProvider = null;
let appSigner = null;
let appAddress = null;

// If opened as file://, show notice so user uses a local server
(function() {
  try {
    if (window.location.protocol === 'file:') {
      var el = document.getElementById('fileProtocolNotice');
      if (el) el.style.display = 'block';
    }
  } catch (_) {}
})();

async function ensure0GNetwork() {
  const eth = window.ethereum;
  if (!eth) return false;
  try {
    await eth.request({ method: 'wallet_addEthereumChain', params: [OG_NETWORK] });
    await eth.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: OG_NETWORK.chainId }] });
    return true;
  } catch (e) {
    console.warn('0G network switch failed', e);
    return false;
  }
}

function truncateAddress(addr) {
  if (!addr || addr.length < 10) return '0x…';
  return addr.slice(0, 6) + '…' + addr.slice(-4);
}

async function fetch0GBalance() {
  if (!appProvider || !appAddress) return null;
  try {
    const bal = await appProvider.getBalance(appAddress);
    const og = Number(ethers.formatEther(bal));
    return og;
  } catch (e) {
    console.warn('Failed to fetch 0G balance', e);
    return null;
  }
}

function update0GBalanceDisplay(val) {
  const el = document.getElementById('ogBalance');
  if (!el) return;
  if (val != null) el.textContent = Number(val).toFixed(2);
}

// ─────────────────────────────────
// COUNTDOWN TIMER
// ─────────────────────────────────
function getMidnightMs() {
  const now = new Date(), m = new Date(now);
  m.setHours(24,0,0,0); return m - now;
}
function fmtTime(ms) {
  const t = Math.max(0, Math.floor(ms/1000));
  const h = Math.floor(t/3600), m = Math.floor((t%3600)/60), s = t%60;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
let remaining = getMidnightMs();
function tickTimers() {
  remaining -= 1000;
  const t = fmtTime(remaining);
  ['globalTimer','timer0','timer1','timer2'].forEach(id => {
    const el = document.getElementById(id); if (el) el.textContent = t;
  });
  if (remaining < 3600000) {
    document.querySelectorAll('.card-timer-val, #globalTimer').forEach(el => el.style.color = '#f87171');
  }
}
tickTimers(); setInterval(tickTimers, 1000);

// ─────────────────────────────────
// CHALLENGE CARDS
// ─────────────────────────────────
const challengeDefs = [
  { pts: 50, usdc: 0.50, label: '+50 PTS — Gold Badge Earned' },
  { pts: 25, usdc: 0.25, label: '+25 PTS — Silver Badge Earned' },
  { pts: 10, usdc: 0.10, label: '+10 PTS — Active Badge Earned' },
];
let pointBalance = 2480;
let ogBalance = 12.40; // shown 0G balance (from chain or local reward)
const completedSet = new Set();

function startChallenge(idx) {
  if (completedSet.has(idx)) return;
  const card = document.getElementById('card'+idx);
  const prog = document.getElementById('prog'+idx);
  const cta  = card.querySelector('.card-cta');
  const c    = challengeDefs[idx];
  cta.textContent = 'Verifying…'; cta.style.opacity = '0.6'; cta.disabled = true;
  prog.style.width = '100%';
  setTimeout(() => {
    completedSet.add(idx);
    card.classList.add('completed');
    cta.textContent = '✓ Done';
    const badge = document.createElement('div');
    badge.className = 'completed-badge'; badge.textContent = '✓ DONE';
    card.appendChild(badge);
    pointBalance += c.pts;
    ogBalance = +(ogBalance + c.usdc).toFixed(2);
    animateBalance('pointBalance', pointBalance.toLocaleString());
    update0GBalanceDisplay(ogBalance);
    showPtsToast(c.label);
    // Refetch on-chain balance so next time we're in sync (rewards may be on-chain later)
    if (appProvider && appAddress) setTimeout(() => refresh0GBalance(), 2000);
  }, 1800);
}
function animateBalance(id, val) {
  const el = document.getElementById(id);
  el.style.transform = 'scale(1.1)'; el.style.color = '#fff'; el.textContent = val;
  setTimeout(() => { el.style.transition='all 0.3s'; el.style.transform='scale(1)'; el.style.color=''; }, 300);
}
let toastTimer;
function showPtsToast(msg) {
  clearTimeout(toastTimer);
  document.getElementById('ptsToastMsg').textContent = msg;
  const t = document.getElementById('ptsToast'); t.classList.add('show');
  toastTimer = setTimeout(() => t.classList.remove('show'), 3200);
}

// ─────────────────────────────────
// WALLET CONNECT (0G Chain)
// ─────────────────────────────────
function isFileProtocol() {
  try {
    return window.location.protocol === 'file:';
  } catch (_) { return true; }
}

function showConnectError(sp, msg, durationMs) {
  if (sp) {
    document.getElementById('spinnerLabel').textContent = 'Connection issue';
    document.getElementById('spinnerSub').textContent = msg;
  }
  setTimeout(function() {
    if (sp) sp.classList.remove('show');
    const opts = document.getElementById('walletOptions');
    if (opts) opts.style.display = '';
  }, durationMs || 4000);
}

async function startConnect(name, subtitle) {
  var sp = document.getElementById('connectSpinner');
  var opts = document.getElementById('walletOptions');
  if (!sp || !opts) return;

  opts.style.display = 'none';
  sp.classList.add('show');
  document.getElementById('spinnerLabel').textContent = 'Connecting ' + name;
  document.getElementById('spinnerSub').textContent = subtitle;

  // Wallet only works over http/https; file:// is blocked by browsers
  if (isFileProtocol()) {
    showConnectError(sp, 'Open this page from a local server (e.g. http://localhost), not as a file. Run in terminal: npx serve .', 8000);
    return;
  }

  var eth = window.ethereum;
  if (!eth) {
    showConnectError(sp, 'No wallet found. Install MetaMask (metamask.io) or open from http://localhost.', 5000);
    return;
  }

  try {
    document.getElementById('spinnerSub').textContent = 'Check your wallet — approve the connection…';
    var accounts = await eth.request({ method: 'eth_requestAccounts' });
    if (!accounts || !accounts[0]) throw new Error('No account');
    document.getElementById('spinnerSub').textContent = 'Switching to 0G network…';
    var ok = await ensure0GNetwork();
    if (!ok) document.getElementById('spinnerSub').textContent = 'Please switch to 0G in your wallet.';
    var provider = new ethers.BrowserProvider(eth);
    var signer = await provider.getSigner();
    var address = accounts[0];
    appProvider = provider;
    appSigner = signer;
    appAddress = address;

    document.getElementById('spinnerSub').textContent = 'Loading your 0G balance…';
    document.getElementById('spinnerLabel').textContent = 'Almost there';
    var chainBal = await fetch0GBalance();
    if (chainBal != null) ogBalance = chainBal;

    launchApp(address);
  } catch (e) {
    console.warn('Wallet connect failed', e);
    var msg = e && e.message ? e.message : 'Connection failed. Try again.';
    if (msg.indexOf('User rejected') !== -1 || msg.indexOf('user rejected') !== -1) msg = 'You declined the connection. Click again to retry.';
    showConnectError(sp, msg, 4500);
  }
}

async function refresh0GBalance() {
  const chainBal = await fetch0GBalance();
  if (chainBal != null) {
    ogBalance = chainBal;
    update0GBalanceDisplay(ogBalance);
  }
}

function launchApp(connectedAddress) {
  if (connectedAddress) {
    const pill = document.getElementById('walletAddr');
    if (pill) pill.textContent = truncateAddress(connectedAddress);
    update0GBalanceDisplay(ogBalance);
  }
  document.getElementById('signinScreen').classList.add('slide-out');
  setTimeout(() => {
    document.getElementById('signinScreen').style.display = 'none';
    document.getElementById('appShell').classList.add('show');
    try { loadEventsFromStorage(); } catch (_) {}
    renderCalendar();
    renderEventsList();
    renderSocialFeed();
  }, 600);
}

// ─────────────────────────────────
// BOTTOM NAV / PAGE SWITCHING
// ─────────────────────────────────
document.querySelectorAll('.bnav-item').forEach(btn => {
  btn.addEventListener('click', () => {
    const page = btn.dataset.page;
    document.querySelectorAll('.bnav-item').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('page-' + page).classList.add('active');
    if (page === 'calendar') { renderCalendar(); renderEventsList(); }
    if (page === 'social') { renderSocialFeed(); }
  });
});

// ─────────────────────────────────
// SOCIAL FEED
// ─────────────────────────────────
const catColors = {
  Tennis: '#c8f135', Cycling: '#5b9bd5', Workout: '#f5c842',
  Skiing: '#b0bec5', Running: '#f97316', Surfing: '#22d3ee', Default: '#a78bfa'
};
const hostColors = ['#c8f135','#5b9bd5','#f5c842','#f97316','#22d3ee','#a78bfa','#fb7185','#34d399'];
function hostColor(name) {
  let h = 0; for (let c of name) h = (h * 31 + c.charCodeAt(0)) & 0xffff;
  return hostColors[h % hostColors.length];
}

let socialFilter = 'All';
function setFilter(btn, cat) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  socialFilter = cat;
  renderSocialFeed();
}

function renderSocialFeed() {
  const feed = document.getElementById('socialFeed');
  const pill = document.getElementById('socialCountPill');
  feed.innerHTML = '';

  const filtered = socialFilter === 'All'
    ? [...userEvents]
    : userEvents.filter(e => e.cat === socialFilter);

  // Sort: own events first, then by date
  filtered.sort((a,b) => {
    if (a.isOwn && !b.isOwn) return -1;
    if (!a.isOwn && b.isOwn) return  1;
    return new Date(a.date) - new Date(b.date);
  });

  pill.textContent = filtered.length + ' event' + (filtered.length !== 1 ? 's' : '');

  if (filtered.length === 0) {
    feed.innerHTML = `
      <div class="social-empty">
        <svg width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="var(--lime)" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/>
        </svg>
        <h3>No events yet</h3>
        <p>No ${socialFilter} events found.<br>Create one from the Calendar tab.</p>
      </div>`;
    return;
  }

  filtered.forEach((evt, i) => {
    const evtIndex = userEvents.indexOf(evt);
    const color = catColors[evt.cat] || catColors.Default;
    const hc    = hostColor(evt.host || 'User');
    const joined      = evt.joined;
    const joinedCount = evt.joinedCount || 0;
    const maxPpl      = evt.participants;
    const spotsLeft   = maxPpl - joinedCount;
    const pct         = Math.min(100, Math.round((joinedCount / maxPpl) * 100));
    const isFull      = spotsLeft <= 0;

    const d = new Date(evt.date + 'T00:00:00');
    const dateStr = d.toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric' });

    let joinLabel, joinClass;
    if (evt.isOwn)  { joinLabel = 'Your Event'; joinClass = 'joined'; }
    else if (joined) { joinLabel = '✓ Joined'; joinClass = 'joined'; }
    else if (isFull) { joinLabel = 'Full'; joinClass = 'full'; }
    else             { joinLabel = 'Join →'; joinClass = 'join'; }

    let spotsHtml;
    if (evt.isOwn) {
      spotsHtml = `<span>${joinedCount} / ${maxPpl} joined</span>`;
    } else if (joined) {
      spotsHtml = `<span>You're in — <strong>${spotsLeft} spot${spotsLeft!==1?'s':''} left</strong></span>`;
    } else if (isFull) {
      spotsHtml = `<span class="full"><strong>Event is full</strong></span>`;
    } else {
      spotsHtml = `<span><strong>${spotsLeft} spot${spotsLeft!==1?'s':''} left</strong> of ${maxPpl}</span>`;
    }

    const card = document.createElement('div');
    card.className = 'social-card';
    card.style.animationDelay = (i * 0.06) + 's';
    card.innerHTML = `
      <div class="social-card-accent" style="background:${color}"></div>
      <div class="social-card-body">
        <div class="sc-top">
          <div class="sc-avatar" style="background:${hc}22;color:${hc};border-color:${hc}44">${evt.hostInitials || 'U'}</div>
          <div class="sc-host-info">
            ${evt.isOwn ? '<span class="sc-owner-badge">Your Event</span><br>' : ''}
            <div class="sc-host-name">${evt.host || 'Anonymous'}</div>
            <div class="sc-host-sub">Organiser</div>
          </div>
          <div class="sc-cat-badge" style="background:${color}18;color:${color};border-color:${color}35">${evt.cat}</div>
        </div>

        <div class="sc-title">${evt.name}</div>
        <div class="sc-desc">${evt.desc || 'No description provided.'}</div>

        <div class="sc-meta">
          <div class="sc-meta-item">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
            ${dateStr}
          </div>
          <div class="sc-meta-item">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
            ${evt.time}
          </div>
          <div class="sc-meta-item">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
            Max ${maxPpl}
          </div>
        </div>

        <div class="sc-participants">
          <div class="sc-participants-label">
            <span class="sc-participants-text">Participants</span>
            <span class="sc-participants-count" style="color:${color}">${joinedCount} / ${maxPpl}</span>
          </div>
          <div class="sc-bar">
            <div class="sc-bar-fill" style="width:${pct}%;background:${color}"></div>
          </div>
        </div>

        <div class="sc-bottom">
          <div class="sc-spots-left ${isFull && !evt.isOwn ? 'full' : ''}">${spotsHtml}</div>
          <button class="join-btn ${joinClass}" ${(joinClass==='joined'||joinClass==='full')?'disabled':''} onclick="joinEvent(${evtIndex}, this)">${joinLabel}</button>
        </div>
      </div>
    `;
    feed.appendChild(card);
  });
}

function joinEvent(idx, btn) {
  const evt = userEvents[idx];
  if (!evt || evt.isOwn || evt.joined) return;
  const maxPpl = evt.participants;
  if (evt.joinedCount >= maxPpl) return;

  evt.joined = true;
  evt.joinedCount = (evt.joinedCount || 0) + 1;

  // Animate button
  btn.textContent = 'Joining…';
  btn.disabled = true;
  btn.style.opacity = '0.7';

  saveEventsToStorage();

  setTimeout(() => {
    renderSocialFeed();
    // Refresh calendar dots + list if calendar page is visible
    const calPage = document.getElementById('page-calendar');
    if (calPage && calPage.classList.contains('active')) {
      renderCalendar();
      renderEventsList();
    }
    showPtsToast('+5 PTS — Joined Event!');
    pointBalance += 5;
    animateBalance('pointBalance', pointBalance.toLocaleString());
  }, 700);
}

// ─────────────────────────────────
// CALENDAR SUB-TABS
// ─────────────────────────────────
function switchCalTab(tab) {
  document.getElementById('calTabView').classList.toggle('active', tab === 'view');
  document.getElementById('calTabCreate').classList.toggle('active', tab === 'create');
  document.getElementById('calPaneView').classList.toggle('active', tab === 'view');
  document.getElementById('calPaneCreate').classList.toggle('active', tab === 'create');
}

// ─────────────────────────────────
// CALENDAR RENDERING
// ─────────────────────────────────
const MONTHS = ['January','February','March','April','May','June','July','August','September','October','November','December'];
let calYear = 2026, calMonth = 1; // 0-indexed, Feb = 1

function renderCalendar() {
  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';
  document.getElementById('calMonthTitle').textContent = `${MONTHS[calMonth].toUpperCase()} ${calYear}`;
  const firstDay = new Date(calYear, calMonth, 1).getDay();
  const daysInMonth = new Date(calYear, calMonth+1, 0).getDate();
  const daysInPrev  = new Date(calYear, calMonth, 0).getDate();
  const today = new Date();

  // prev month tail
  for (let i = firstDay - 1; i >= 0; i--) {
    const cell = document.createElement('div');
    cell.className = 'cal-cell other-month';
    cell.textContent = daysInPrev - i;
    grid.appendChild(cell);
  }
  // current month
  for (let d = 1; d <= daysInMonth; d++) {
    const cell = document.createElement('div');
    let cls = 'cal-cell';
    if (d === today.getDate() && calMonth === today.getMonth() && calYear === today.getFullYear()) cls += ' today';
    // mark days with own or joined events
    if (userEvents.some(e => {
      if (!e.isOwn && !e.joined) return false;
      const ed = new Date(e.date);
      return ed.getDate()===d && ed.getMonth()===calMonth && ed.getFullYear()===calYear;
    })) cls += ' has-event';
    cell.className = cls;
    cell.textContent = d;
    cell.onclick = () => selectDay(d, cell);
    grid.appendChild(cell);
  }
  // next month fill
  const total = firstDay + daysInMonth;
  const remaining = total % 7 === 0 ? 0 : 7 - (total % 7);
  for (let i = 1; i <= remaining; i++) {
    const cell = document.createElement('div');
    cell.className = 'cal-cell other-month';
    cell.textContent = i;
    grid.appendChild(cell);
  }
}

function selectDay(d, cell) {
  document.querySelectorAll('.cal-cell').forEach(c => c.classList.remove('selected'));
  cell.classList.add('selected');
  renderEventsList(d);
}

function changeMonth(dir) {
  calMonth += dir;
  if (calMonth > 11) { calMonth = 0; calYear++; }
  if (calMonth < 0)  { calMonth = 11; calYear--; }
  renderCalendar(); renderEventsList();
}

// ─────────────────────────────────
// 0G STORAGE / PERSISTENCE
// ─────────────────────────────────
const STORAGE_KEY = 'attivo_events';
const STORAGE_ROOT_KEY = 'attivo_0g_storage_root'; // for future 0G Storage root hash

function saveEventsToStorage() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(userEvents));
    // Optional: upload same JSON to 0G Storage (indexer.upload) and save root in STORAGE_ROOT_KEY.
    // Use @0glabs/0g-ts-sdk/browser with a build (e.g. Vite) for browser upload.
    if (typeof window.uploadAttivoEventsTo0G === 'function' && appSigner) {
      window.uploadAttivoEventsTo0G(JSON.stringify(userEvents), appSigner).then(function(root) {
        if (root) localStorage.setItem(STORAGE_ROOT_KEY, root);
      }).catch(function() {});
    }
  } catch (e) { console.warn('Save events failed', e); }
}

function loadEventsFromStorage() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed) && parsed.length > 0) userEvents = parsed;
    }
  } catch (e) { console.warn('Load events failed', e); }
}

// ─────────────────────────────────
// EVENTS DATA & RENDERING
// ─────────────────────────────────
// Pre-seeded events (used when no saved data)
let userEvents = [
  { name: 'Doubles Match',       cat: 'Tennis',  date: '2026-02-20', time: '07:00', participants: 4,  desc: 'Morning doubles at the club. All levels welcome — we rally for an hour then play a set.', joinedCount: 2, isOwn: true,  host: 'Alex R.',    hostInitials: 'AR', joined: false },
  { name: 'Zwift Ride',          cat: 'Cycling', date: '2026-02-22', time: '06:30', participants: 1,  desc: 'Indoor 30km on Zwift. Join the group ride on Watopia — Tempus Fugit route.', joinedCount: 1, isOwn: true,  host: 'Alex R.',    hostInitials: 'AR', joined: false },
  { name: 'Powder Day',          cat: 'Skiing',  date: '2026-02-28', time: '09:00', participants: 6,  desc: 'All day at Verbier. Meeting at the gondola 9am sharp. Bring a packed lunch!', joinedCount: 4, isOwn: true,  host: 'Alex R.',    hostInitials: 'AR', joined: false },
  { name: 'Morning Hit-Up',      cat: 'Tennis',  date: '2026-02-21', time: '08:00', participants: 4,  desc: 'Casual morning hit-up at Parc des Eaux-Vives. Bring your own balls. Beginners friendly.', joinedCount: 1, isOwn: false, host: 'Sara M.',    hostInitials: 'SM', joined: false },
  { name: 'Cols du Jura Ride',   cat: 'Cycling', date: '2026-02-25', time: '07:30', participants: 8,  desc: '80km road ride through the Jura cols. Moderate pace, coffee stop at the top. Road bikes only.', joinedCount: 5, isOwn: false, host: 'Tom B.',     hostInitials: 'TB', joined: false },
  { name: 'CrossFit Saturday',   cat: 'Workout', date: '2026-02-22', time: '10:00', participants: 12, desc: 'Open WOD at the box. All levels, scale as needed. 1hr session followed by stretching.', joinedCount: 7, isOwn: false, host: 'Coach Lena', hostInitials: 'CL', joined: false },
  { name: 'Backcountry Touring', cat: 'Skiing',  date: '2026-03-01', time: '08:00', participants: 5,  desc: 'Ski touring above Chamonix. Intermediate+ level required. Avalanche gear mandatory.', joinedCount: 2, isOwn: false, host: 'Marco D.',   hostInitials: 'MD', joined: false },
  { name: 'Park Run',            cat: 'Running', date: '2026-02-21', time: '09:00', participants: 20, desc: 'Weekly 5km park run — Parc La Grange. Bring a friend! All paces welcome. Free to join.', joinedCount: 12, isOwn: false, host: 'Nina K.',    hostInitials: 'NK', joined: false },
];

function renderEventsList(filterDay = null) {
  const list = document.getElementById('eventsList');
  const title = document.getElementById('eventsListTitle');
  list.innerHTML = '';

  // Show own events AND events the user has joined
  const filtered = userEvents.filter(e => {
    if (!e.isOwn && !e.joined) return false; // only own + joined
    const ed = new Date(e.date);
    if (ed.getMonth() !== calMonth || ed.getFullYear() !== calYear) return false;
    if (filterDay !== null && ed.getDate() !== filterDay) return false;
    return true;
  });

  title.textContent = filterDay
    ? `Events on ${MONTHS[calMonth]} ${filterDay}`
    : `Events in ${MONTHS[calMonth]} ${calYear}`;

  if (filtered.length === 0) {
    list.innerHTML = `<div style="font-size:13px;color:var(--muted);padding:8px 0;font-weight:300;">No events ${filterDay ? 'on this day' : 'this month'}. <span style="color:var(--lime);cursor:pointer" onclick="switchCalTab('create')">Create one →</span></div>`;
    return;
  }

  filtered.forEach((e, delay) => {
    const color = catColors[e.cat] || catColors.Default;
    const d = new Date(e.date);
    const dateStr = d.toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric' });
    const div = document.createElement('div');
    div.className = 'event-item';
    div.style.animationDelay = delay * 0.05 + 's';
    const roleLabel = e.isOwn ? 'Organiser' : 'Joined';
    const roleBg    = e.isOwn ? 'background:var(--lime-faint);color:var(--lime);border-color:rgba(200,241,53,0.2)' : 'background:rgba(91,141,238,0.1);color:#5b9bd5;border-color:rgba(91,141,238,0.25)';
    div.innerHTML = `
      <div class="event-item-dot" style="background:${color};box-shadow:0 0 6px ${color}50"></div>
      <div class="event-item-body">
        <div class="event-item-name">${e.name}</div>
        <div class="event-item-meta">
          <span>${dateStr} · ${e.time}</span>
          <span>${e.participants} spots · ${e.joinedCount || 1} joined</span>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:5px;flex-shrink:0">
        <div class="event-item-cat">${e.cat}</div>
        <div style="font-size:10px;padding:2px 8px;border-radius:100px;border:1px solid;${roleBg};letter-spacing:0.5px;white-space:nowrap">${roleLabel}</div>
      </div>
    `;
    list.appendChild(div);
  });
}

// ─────────────────────────────────
// CREATE EVENT FORM
// ─────────────────────────────────
let selectedCat = null;
let participantCount = 4;

// Set today as default date
(function setDefaultDate() {
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm   = String(today.getMonth()+1).padStart(2,'0');
  const dd   = String(today.getDate()).padStart(2,'0');
  const el   = document.getElementById('evtDate');
  if (el) { el.value = `${yyyy}-${mm}-${dd}`; el.min = `${yyyy}-${mm}-${dd}`; }
})();

function selectCat(btn) {
  document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('selected'));
  btn.classList.add('selected');
  selectedCat = btn.dataset.cat;
}

function adjustParticipants(delta) {
  participantCount = Math.max(1, Math.min(50, participantCount + delta));
  document.getElementById('pCount').textContent = participantCount;
}

function submitEvent() {
  const name = document.getElementById('evtName').value.trim();
  const desc = document.getElementById('evtDesc').value.trim();
  const date = document.getElementById('evtDate').value;
  const time = document.getElementById('evtTime').value;

  if (!name)         { flashInput('evtName', 'Event name is required'); return; }
  if (!selectedCat)  { flashCats(); return; }
  if (!date)         { flashInput('evtDate', 'Please pick a date'); return; }

  // Build event object
  const evt = { name, desc, cat: selectedCat, date, time, participants: participantCount, joinedCount: 1, isOwn: true, host: 'Alex R.', hostInitials: 'AR', joined: false };
  userEvents.push(evt);
  saveEventsToStorage();

  // Fill modal
  const d = new Date(date);
  const dateStr = d.toLocaleDateString('en-US', { weekday:'long', month:'long', day:'numeric', year:'numeric' });
  document.getElementById('mecName').textContent = name;
  document.getElementById('mecCat').textContent  = selectedCat;
  document.getElementById('mecDate').textContent = `${dateStr} · ${time}`;
  document.getElementById('mecParticipants').textContent = `${participantCount} participant${participantCount!==1?'s':''} max`;

  // Refresh social if it's currently visible
  const socialPage = document.getElementById('page-social');
  if (socialPage && socialPage.classList.contains('active')) renderSocialFeed();
  // Show modal
  document.getElementById('confirmModal').classList.add('show');
}

function flashInput(id, msg) {
  const el = document.getElementById(id);
  el.style.borderColor = '#f87171';
  el.focus();
  setTimeout(() => el.style.borderColor = '', 2000);
}
function flashCats() {
  const el = document.getElementById('catScroll');
  el.style.outline = '2px solid #f87171'; el.style.borderRadius = '8px';
  setTimeout(() => el.style.outline = '', 2000);
}

function closeModal() {
  document.getElementById('confirmModal').classList.remove('show');
  // Reset form
  document.getElementById('evtName').value = '';
  document.getElementById('evtDesc').value = '';
  document.getElementById('pCount').textContent = '4';
  participantCount = 4; selectedCat = null;
  document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('selected'));
  // Navigate to calendar view
  document.querySelectorAll('.bnav-item').forEach(b => b.classList.remove('active'));
  document.querySelector('[data-page="calendar"]').classList.add('active');
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-calendar').classList.add('active');
  switchCalTab('view');
  // Sync calendar month to event month
  const evtDate = new Date(document.getElementById('evtDate').value || new Date());
  calMonth = evtDate.getMonth(); calYear = evtDate.getFullYear();
  renderCalendar(); renderEventsList();
}

// Close modal on backdrop click
document.getElementById('confirmModal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
</script>
</body>
</html>
